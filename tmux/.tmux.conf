# Support 24 bit colors
set -g  default-terminal "xterm-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Replace the default prefix key binding
# This also fixes double Ctrl-B to go one page up in vim/less
set -g prefix C-Space

# Split panes using h and v
bind h splitw -h
bind v splitw -v
unbind '"'
unbind %

# Fix escape key delay in vim
set -sg escape-time 0

# Fix ssh agent when tmux is detached
set    -g update-environment -r
setenv -g SSH_AUTH_SOCK $HOME/.ssh/ssh_auth_sock

# Make terminal selection & tmux selection play nice with each other
# Only turn on mouse mode on scroll up
set  -g mouse off
bind -n Up             if-shell "~/.local/bin/pscheck #{pane_pid} man less" "send Up" "set -w mouse on \; copy-mode -e"
bind -n WheelDownPane  selectp -t= \; set -w mouse off \; send -M
bind -T copy-mode-vi q send -X cancel \; set -w mouse off

# Don't exit copy mode on mouse selection
unbind -T copy-mode-vi MouseDragEnd1Pane

# Copy to system clipboard with `y`
bind -T copy-mode-vi y send -X copy-pipe-and-cancel 'nc 127.0.0.1 2224 --send-only' \; set -w mouse off

# Fix fish_title doesn't work in tmux
set  -g set-titles on
set  -g set-titles-string '#T'

# Set vi mode for copy mode
setw -g mode-keys vi

# Start window numbers at 1 to match keyboard order with tmux window order
set  -g base-index 1
setw -g pane-base-index 1

# Renumber windows sequentially after closing any of them
set  -g renumber-windows on

# Soften status bar color from harsh green to light gray
set  -g status-style bg='#666666',fg='#aaaaaa'

# Remove administrative debris (session name, hostname, time) in status bar
set  -g status-left ''
set  -g status-right ''

# Increase scrollback lines
set  -g history-limit 50000

# Don't suspend-client
unbind C-z

# Styles
set -g pane-border-style 'fg=#474e5d bg=#17171d'
set -g pane-active-border-style 'fg=#474e5d bg=#17171d'

set -g status-position bottom
set -g status-justify left
set -g status-style 'bg=#282c34 fg=#dcdfe4 dim'

setw -g window-status-current-style 'fg=#ffffff bg=#474e5d bold'
setw -g window-status-current-format ' #I:#W '

setw -g window-status-style 'fg=#DCDFE4 bg=#313640 dim'
setw -g window-status-format ' #I:#W '

# Use Option key as tmux prefix
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

bind -n M-\\ split-window -h -p 50 -c "#{pane_current_path}"
bind -n M--  split-window -v -p 25 -c "#{pane_current_path}"

bind -n M-t new-window
bind -n M-w kill-window
bind -n M-n next-window
bind -n M-p previous-window
bind -n M-r source ~/.tmux.conf \; display "~/.tmux.conf reloaded"

# Fix Ctrl+P doesn't work as expected in kubectl exec bash
# https://github.com/kubernetes/kubernetes/issues/71765
# https://stackoverflow.com/questions/59739696/kubectl-exec-bin-bash-eating-control-p
bind -n C-p send Up
