#!/bin/bash

FZF_SELECTED_FILES=/tmp/fzf_selected_files

rg \
  --colors "match:none" \
  --colors "path:fg:138,138,138" \
  --colors "line:fg:yellow" \
  --colors "column:fg:yellow" \
  --column \
  --line-number \
  --no-heading \
  --color=always \
  --smart-case \
  --fixed-strings \
  --hidden \
  --glob "!.git" \
  -- "$1" \
  | devicon add \
  | fzf --ansi \
      --height=100% \
      --scheme=path \
      --header="$(tput setaf 1)ENTER$(tput sgr0) to open, $(tput setaf 1)CTRL-Y$(tput sgr0) to copy, $(tput setaf 1)CTRL-/$(tput sgr0) to toggle preview" \
      --preview="preview {}" \
      --preview-window=right,60%,border-sharp \
      --bind="enter:execute/echo $PWD/{} | devicon remove | cut -d: -f1-3 | xargs | tee ${FZF_SELECTED_FILES}/+abort" \
      --bind="tab:execute/echo $PWD/{} | devicon remove | cut -d: -f1-3 | xargs | tee ${FZF_SELECTED_FILES}/+abort" \
      --bind="ctrl-y:execute/echo {} | devicon remove | cut -d: -f1-3 | pbcopy/+abort"
