#!/usr/bin/env bash

if [ $# -eq 0 ]; then
  exec nvim \
    -u NONE \
    -c "map <silent> q :<C-u>qa!<CR>" \
    -c "set shell=bash scrollback=100000 laststatus=0 clipboard+=unnamedplus nowrap" \
    -c "autocmd TermEnter * stopinsert" \
    -c "nmap C /^commit\\\|^added:\\\|^deleted:\\\|^modified:<CR>" \
    -c "nmap A ?Applied catalog in .* seconds<CR>" \
    -c "nmap <CR>  :nohlsearch<CR>" \
    -c "nmap <ESC> :nohlsearch<CR>" \
    -c "nmap H zH | nmap L zL" \
    -c "nmap a <nop> | nmap i <nop>" \
    -c 'terminal sed </dev/fd/63 -e "s/'$'\x1b'']8;;file:[^\]*[\]//g" && sleep 0.01 && printf "'$'\x1b'']2;"' 63<&0 0</dev/null
else
  exec nvim \
    -u NONE \
    -c "map <silent> q :<C-u>qa!<CR>" \
    -c "set shell=bash scrollback=100000 laststatus=0 clipboard+=unnamedplus nowrap" \
    -c "autocmd TermEnter * stopinsert" \
    -c "nmap C /^commit\\\|^added:\\\|^deleted:\\\|^modified:<CR>" \
    -c "nmap A ?Applied catalog in .* seconds<CR>" \
    -c "nmap <CR>  :nohlsearch<CR>" \
    -c "nmap <ESC> :nohlsearch<CR>" \
    -c "nmap H zH | nmap L zL" \
    -c "nmap a <nop> | nmap i <nop>" \
    "$@"
fi
